<!DOCTYPE html>
<html lang="en">
<head>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4514307373624605"
     crossorigin="anonymous"></script>


    <meta name="description" content="PDFTree: Free, secure PDF conversion and merging in your browser. Convert images (JPG, PNG), text, and merge PDFs. Files stay local. Ideal for businesses protecting customer data.">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFTree - Free & Secure PDF Converter & Merger | Client-Side Privacy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth; /* Added for smooth scrolling */
        }
        /* Custom scrollbar for file list and textarea - Earth Tones */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #44403c; /* stone-700 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #78716c; /* stone-500 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; /* stone-400 */
        }
        .loader {
            border-top-color: #fbbf24; /* amber-400 */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        button, .button-link {
            min-width: 120px;
        }
        hr {
            border-color: #57534e; /* stone-600 */
        }

        /* --- Styles for privacy section --- */
        .privacy-note {
            color: #27ae60; /* Green for reassurance */
            font-weight: bold;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }
        .privacy-note .fa-lock {
            margin-right: 8px;
            font-size: 1.1em;
        }
        .privacy-features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 40px;
            text-align: left;
        }
        .feature-card {
            background-color: #44403c; /* stone-700 */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .feature-card .icon {
            font-size: 2.5em;
            color: #fbbf24; /* amber-400 */
            margin-bottom: 15px;
        }
        .feature-card h3 {
            font-size: 1.25em;
            font-weight: 600;
            color: #fbbf24; /* amber-400 */
            margin-bottom: 10px;
        }
        .feature-card p {
            font-size: 0.95em;
            color: #d1d5db; /* stone-300 */
        }
        .privacy-steps-list {
            list-style: none; /* Remove default list style */
            counter-reset: step-counter;
            padding: 0;
            max-width: 600px;
            margin: 30px auto 0 auto;
            text-align: left; /* Align list items to the left */
        }
        .privacy-steps-list li {
            position: relative;
            padding-left: 40px;
            margin-bottom: 15px;
            font-size: 1.05em;
            color: #d1d5db; /* stone-300 */
        }
        .privacy-steps-list li:before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background-color: #f97316; /* orange-500 */
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .nav-link {
            color: #a8a29e; /* stone-400 */
            transition: color 0.2s ease-in-out;
        }
        .nav-link:hover {
            color: #fbbf24; /* amber-400 */
        }

        .drop-area {
            border: 2px dashed #78716c; /* stone-500 */
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s ease-in-out, background-color 0.3s ease-in-out;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        .drop-area.drag-over {
            border-color: #fbbf24; /* amber-400 */
            background-color: #57534e; /* stone-600 */
        }
        .drop-area-text {
            color: #a8a29e; /* stone-400 */
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .drop-area input[type="file"] {
            display: none;
        }
        .content-section ul {
            list-style-type: disc;
            margin-left: 20px;
            text-align: left;
        }
        .content-section li {
            margin-bottom: 0.5rem;
        }
        /* Target for scroll offset due to fixed header if you add one later */
        [id]::before {
          content: "";
          display: block;
          height: 60px; /* Adjust this value based on your header's height */
          margin-top: -60px; /* Negative margin of the same value */
          visibility: hidden;
        }


    </style>
</head>
<body class="bg-gradient-to-br from-neutral-800 to-stone-900 text-stone-200 min-h-screen flex flex-col items-center justify-center p-4 selection:bg-amber-500 selection:text-white">

    <div class="bg-stone-800 shadow-2xl rounded-xl p-6 md:p-8 w-full max-w-2xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-amber-400">Secure PDF Conversion Done On Your Computer And Nowhere Else.</h1>
            <nav class="mt-4">
                <a href="index.html" class="nav-link text-lg mx-3 font-semibold text-amber-400">Home</a>
                <span class="text-stone-500">|</span>
                <a href="#mergePdfSection" class="nav-link text-lg mx-3">Merge PDFs</a>
                <span class="text-stone-500">|</span>
                <a href="about.html" class="nav-link text-lg mx-3">About PDFTree</a>
                <span class="text-stone-500">|</span> <a href="#howToUseSection" class="nav-link text-lg mx-3">How To Use</a>
            </nav>
        </header>

        <main>
            <section id="imageToPdfSection" class="mb-8">
                <h2 class="text-xl font-semibold text-amber-300 mb-4">Images to PDF</h2>
                <div class="drop-area" id="dropArea">
                    <p class="drop-area-text">Drag & Drop Images (JPG, PNG) here</p>
                    <p class="drop-area-text">or</p>
                    <label for="imageUpload" class="block text-sm font-medium text-stone-300 mb-2">
                        <span class="inline-block py-2 px-4 rounded-lg border-0 text-sm font-semibold bg-orange-600 text-orange-50 hover:bg-orange-700 cursor-pointer transition-colors">Browse Files</span>
                    </label>
                    <input type="file" id="imageUpload" multiple accept="image/jpeg, image/png">
                    <p class="privacy-note"><i class="fas fa-lock"></i> Your images stay on your device, never uploaded.</p>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-medium text-stone-300 mb-1">Selected Files:</h3>
                    <div id="fileList" class="custom-scrollbar max-h-32 overflow-y-auto bg-stone-700 p-3 rounded-lg border border-stone-600 text-xs text-stone-300">
                        No files selected.
                    </div>
                </div>

                <div class="mb-6">
                    <label for="imagePageSize" class="block text-sm font-medium text-stone-300 mb-1">PDF Page Size (for Images):</label>
                    <select id="imagePageSize" class="w-full p-2 bg-stone-700 border border-stone-600 rounded-lg text-stone-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                        <option value="Letter" selected>Letter (Recommended)</option>
                        <option value="A4">A4</option>
                        <option value="FitImage">Fit to Image (First Image)</option>
                    </select>
                </div>

                <div class="text-center">
                    <button id="convertImagesToPdfButton"
                        class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md transition-all duration-150 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center mx-auto">
                        <span id="imageButtonText">Convert Images to PDF</span>
                        <div id="imageLoader" class="loader w-5 h-5 rounded-full border-2 border-stone-300 border-t-amber-400 ml-2 hidden"></div>
                    </button>
                </div>
            </section>

            <hr class="my-8">

            <section id="textToPdfSection" class="mb-8">
                <h2 class="text-xl font-semibold text-amber-300 mb-4">Text to PDF</h2>
                <div class="mb-6">
                    <label for="textInput" class="block text-sm font-medium text-stone-300 mb-2">Paste your text here:</label>
                    <textarea id="textInput" rows="10"
                        class="custom-scrollbar w-full p-3 bg-stone-700 border border-stone-600 rounded-lg text-stone-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none placeholder-stone-500 resize-y"
                        placeholder="Enter text to convert to PDF..."></textarea>
                    <p class="privacy-note"><i class="fas fa-lock"></i> Your text stays on your device, never uploaded.</p>
                </div>

                <div class="mb-6">
                    <label for="textPageSize" class="block text-sm font-medium text-stone-300 mb-1">PDF Page Size (for Text):</label>
                    <select id="textPageSize" class="w-full p-2 bg-stone-700 border border-stone-600 rounded-lg text-stone-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                        <option value="Letter" selected>Letter</option>
                        <option value="A4">A4</option>
                    </select>
                </div>
                 <div class="mb-6">
                    <label for="fontSize" class="block text-sm font-medium text-stone-300 mb-1">Font Size:</label>
                    <input type="number" id="fontSize" value="12" min="6" max="72"
                        class="w-full p-2 bg-stone-700 border border-stone-600 rounded-lg text-stone-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                </div>

                <div class="text-center">
                    <button id="convertTextToPdfButton"
                        class="bg-lime-600 hover:bg-lime-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md transition-all duration-150 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center mx-auto">
                        <span id="textButtonText">Convert Text to PDF</span>
                        <div id="textLoader" class="loader w-5 h-5 rounded-full border-2 border-stone-300 border-t-amber-400 ml-2 hidden"></div>
                    </button>
                </div>
            </section>

            <hr class="my-8">

            <section id="mergePdfSection" class="mb-8">
                <h2 class="text-xl font-semibold text-amber-300 mb-4">Merge PDFs</h2>
                <div class="drop-area" id="mergeDropArea">
                    <p class="drop-area-text">Drag & Drop PDFs here</p>
                    <p class="drop-area-text">or</p>
                    <label for="pdfUpload" class="block text-sm font-medium text-stone-300 mb-2">
                        <span class="inline-block py-2 px-4 rounded-lg border-0 text-sm font-semibold bg-blue-600 text-blue-50 hover:bg-blue-700 cursor-pointer transition-colors">Browse PDF Files</span>
                    </label>
                    <input type="file" id="pdfUpload" multiple accept="application/pdf">
                    <p class="privacy-note"><i class="fas fa-lock"></i> Your PDFs stay on your device, never uploaded.</p>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-medium text-stone-300 mb-1">Selected PDF Files (drag to reorder):</h3>
                    <div id="mergeFileList" class="custom-scrollbar max-h-40 overflow-y-auto bg-stone-700 p-3 rounded-lg border border-stone-600 text-xs text-stone-300">
                        No PDF files selected.
                    </div>
                </div>

                <div class="text-center">
                    <button id="mergePdfsButton"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md transition-all duration-150 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center mx-auto">
                        <span id="mergeButtonText">Merge PDFs</span>
                        <div id="mergeLoader" class="loader w-5 h-5 rounded-full border-2 border-stone-300 border-t-amber-400 ml-2 hidden"></div>
                    </button>
                </div>
            </section>

            <hr class="my-8">

            <section class="privacy-section text-center mb-8">
                <h2 class="text-2xl font-semibold text-amber-300 mb-6">How PDFTree Keeps Your Data Private</h2>
                <div class="privacy-features-grid">
                    <div class="feature-card">
                        <span class="icon"><i class="fas fa-cloud-arrow-down"></i></span>
                        <h3>No Server Uploads</h3>
                        <p>Your files are never uploaded to any servers. All conversion processes happen directly on your device.</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon"><i class="fas fa-laptop-code"></i></span>
                        <h3>Purely Client-Side</h3>
                        <p>PDFTree leverages advanced browser technology to perform conversions directly within your web browser.</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon"><i class="fas fa-shield-alt"></i></span>
                        <h3>Complete Control</h3>
                        <p>You maintain full control over your sensitive documents, ensuring your privacy is always protected.</p>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-amber-300 mb-4">The Process is Simple & Private:</h3>
                <ol class="privacy-steps-list">
                    <li><strong>Select Your Document:</strong> Choose the images, text, or PDFs you want to convert from your computer.</li>
                    <li><strong>Browser Processes:</strong> Our innovative code processes your file directly in your web browser.</li>
                    <li><strong>Download Your PDF:</strong> Your new PDF is generated instantly and ready for download, all without ever leaving your device.</li>
                </ol>
            </section>

            <hr class="my-8">

            <section id="howToUseSection" class="content-section text-stone-300 mb-8 px-4">
                <h2 class="text-2xl font-semibold text-amber-300 mb-6 text-center">How to Use PDFTree</h2>

                <h3 class="text-xl font-semibold text-amber-200 mb-3">Merging PDFs:</h3>
                <ul class="mb-6">
                    <li><strong>Step 1: Select PDFs</strong> - Drag and drop your PDF files onto the "Drag & Drop PDFs here" area, or click "Browse PDF Files" to select them from your computer.</li>
                    <li><strong>Step 2: Review & Reorder Files</strong> - Your selected PDFs will appear in the "Selected PDF Files" list. You can drag and drop the file names to change the order they will be merged in.</li>
                    <li><strong>Step 3: Merge</strong> - Click the "Merge PDFs" button. The tool will combine the PDFs directly in your browser.</li>
                    <li><strong>Step 4: Download</strong> - Once merging is complete, a "Download PDF" link will appear. Click it to save your new combined PDF document.</li>
                </ul>

                <h3 class="text-xl font-semibold text-amber-200 mb-3">Converting Images to PDF:</h3>
                <ul class="mb-6">
                    <li><strong>Step 1: Select Images</strong> - Drag and drop your JPG or PNG images onto the "Drag & Drop" area, or click "Browse Files" to select images from your computer.</li>
                    <li><strong>Step 2: Review Files</strong> - Your selected images will appear in the "Selected Files" list. Ensure these are the correct images you wish to convert.</li>
                    <li><strong>Step 3: Choose Page Size</strong> - Select your desired PDF page size from the dropdown menu. "Letter" is recommended, or choose "Fit to Image" to base the page size on the dimensions of your first image.</li>
                    <li><strong>Step 4: Convert</strong> - Click the "Convert Images to PDF" button. The tool will process the images directly in your browser.</li>
                    <li><strong>Step 5: Download</strong> - Once processing is complete, a "Download PDF" link will appear. Click it to save your new PDF document.</li>
                </ul>

                <h3 class="text-xl font-semibold text-amber-200 mb-3">Converting Text to PDF:</h3>
                <ul class="mb-6">
                    <li><strong>Step 1: Input Text</strong> - Paste or type your text directly into the "Paste your text here" textarea.</li>
                    <li><strong>Step 2: Choose Page Size</strong> - Select the preferred PDF page size (Letter or A4) for your text document.</li>
                    <li><strong>Step 3: Set Font Size</strong> - Adjust the font size for your text using the "Font Size" input field. The default is 12.</li>
                    <li><strong>Step 4: Convert</strong> - Click the "Convert Text to PDF" button. The text will be processed locally.</li>
                    <li><strong>Step 5: Download</strong> - A "Download PDF" link will be provided once the PDF is generated. Click to save your document.</li>
                </ul>
                <p class="text-sm text-stone-400 text-center">All conversions are done securely in your browser. Your files and data are never uploaded to any server.</p>
            </section>

            <hr class="my-8">

            <section id="whyUsePdfTreeSection" class="content-section text-stone-300 mb-8 px-4"> <h2 class="text-2xl font-semibold text-amber-300 mb-6 text-center">Why Use PDFTree?</h2>
                <ul class="mb-6">
                    <li><strong>Unparalleled Privacy:</strong> Unlike most online PDF converters, PDFTree processes all your files directly within your web browser. This means your sensitive documents, images, and text never leave your computer and are never uploaded to external servers. Your data remains 100% private and secure.</li>
                    <li><strong>Versatile Tools:</strong> Merge multiple PDFs into one, convert images (JPG, PNG) to PDF, or turn plain text into a PDF document.</li>
                    <li><strong>Completely Free:</strong> Access all conversion and merging features without any cost. PDFTree is free to use for everyone.</li>
                    <li><strong>No Registration Required:</strong> Get straight to converting. You don't need to create an account or sign up for anything.</li>
                    <li><strong>Client-Side Processing:</strong> By leveraging the power of your own device, conversions are fast and you maintain complete control over your data from start to finish.</li>
                    <li><strong>User-Friendly Interface:</strong> PDFTree is designed to be simple and intuitive. Convert your files to PDF in just a few clicks with a clean and straightforward layout.</li>
                    <li><strong>Supports Key Formats:</strong> Easily merge PDFs, convert common image types (JPG, PNG), and plain text into universally accessible PDF documents.</li>
                    <li><strong>Customizable Output:</strong> Choose from standard page sizes and adjust font sizes for text documents to get your PDF looking just the way you want it.</li>
                </ul>
                <p class="text-sm text-stone-400 text-center">PDFTree is ideal for individuals and businesses who prioritize data security and need a quick, reliable PDF conversion tool without compromising on privacy.</p>
            </section>


            <hr class="my-8">

            <div id="statusArea" class="min-h-[24px] mb-4 text-sm text-center font-medium"></div>
            <div id="downloadArea" class="text-center"></div>
        </main>

        <footer class="mt-8 text-center">
            <p class="text-xs text-stone-500 mb-4">
                &copy; <span id="currentYear"></span> PDFTree. Secure PDF Conversion done on your computer and nowhere else.
            </p>
            <div class="flex justify-center space-x-4">
                <a href="https://paypal.me/trreyy?country.x=US&locale.x=en_US" id="donateLink" target="_blank" rel="noopener noreferrer" class="button-link inline-flex items-center justify-center bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-5 rounded-lg shadow-md transition-colors duration-150 ease-in-out transform hover:scale-105">
                    <i class="fas fa-heart mr-2"></i> Support PDFTree
                </a>
                <a href="https://www.instagram.com/pdftree/" target="_blank" rel="noopener noreferrer" class="button-link inline-flex items-center justify-center bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-5 rounded-lg shadow-md transition-colors duration-150 ease-in-out transform hover:scale-105">
                    <i class="fab fa-instagram mr-2"></i> Follow on Instagram
                </a>
            </div>
            
            <p class="text-stone-400 mt-4 p-4"> Unlike other online converters, PDFTree processes all your documents directly in your web browser, for free. This means your sensitive files never leave your computer and are never uploaded to our servers, ensuring your data remains private and secure. If you have any questions email contact@pdftree.org. Desktop Application with .docx to PDF coming soon!
            </p>
        </footer>
    </div>

    <script>
        // Common Elements
        const statusArea = document.getElementById('statusArea');
        const downloadArea = document.getElementById('downloadArea');
        const { PDFDocument, StandardFonts, rgb, PageSizes, layoutMultilineText } = PDFLib;

        // Image to PDF Elements
        const imageUpload = document.getElementById('imageUpload');
        const dropArea = document.getElementById('dropArea');
        const fileListDiv = document.getElementById('fileList');
        const convertImagesToPdfButton = document.getElementById('convertImagesToPdfButton');
        const imageButtonText = document.getElementById('imageButtonText');
        const imageLoader = document.getElementById('imageLoader');
        const imagePageSizeSelect = document.getElementById('imagePageSize');
        let selectedImageFiles = [];

        // Text to PDF Elements
        const textInput = document.getElementById('textInput');
        const convertTextToPdfButton = document.getElementById('convertTextToPdfButton');
        const textButtonText = document.getElementById('textButtonText');
        const textLoader = document.getElementById('textLoader');
        const textPageSizeSelect = document.getElementById('textPageSize');
        const fontSizeInput = document.getElementById('fontSize');

        // Merge PDF Elements
        const pdfUpload = document.getElementById('pdfUpload');
        const mergeDropArea = document.getElementById('mergeDropArea');
        const mergeFileListDiv = document.getElementById('mergeFileList');
        const mergePdfsButton = document.getElementById('mergePdfsButton');
        const mergeButtonText = document.getElementById('mergeButtonText');
        const mergeLoader = document.getElementById('mergeLoader');
        let selectedPdfFiles = [];
        let draggedItem = null;


        // --- Utility Functions ---

        /**
         * Shows a status message.
         * @param {string} message - The message to display.
         * @param {'success' | 'error' | 'info'} type - The type of message.
         */
        function showStatus(message, type = 'info') {
            statusArea.textContent = message;
            statusArea.classList.remove('text-green-400', 'text-red-400', 'text-amber-300');
            switch (type) {
                case 'success': statusArea.classList.add('text-green-400'); break;
                case 'error': statusArea.classList.add('text-red-400'); break;
                case 'info': default: statusArea.classList.add('text-amber-300'); break;
            }
        }

        /**
         * Creates and offers a PDF for download.
         * @param {Uint8Array} pdfBytes - The PDF data.
         * @param {string} baseFileName - The base name for the downloaded file.
         */
        function offerPdfDownload(pdfBytes, baseFileName) {
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `PDFTree_${baseFileName}_${Date.now()}.pdf`;
            a.textContent = 'Download PDF';
            a.className = 'bg-amber-600 hover:bg-amber-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md inline-block transition-colors';

            downloadArea.innerHTML = '';
            downloadArea.appendChild(a);
            downloadArea.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // --- Image to PDF Logic ---

        function handleImageFiles(files) {
            selectedImageFiles = [];
            fileListDiv.innerHTML = '';
            downloadArea.innerHTML = '';
            statusArea.textContent = '';

            const validImageTypes = ['image/jpeg', 'image/png'];
            const acceptedFiles = Array.from(files).filter(file => validImageTypes.includes(file.type));

            if (acceptedFiles.length > 0) {
                selectedImageFiles = acceptedFiles;
                const ul = document.createElement('ul');
                ul.className = 'list-disc list-inside text-stone-300';
                selectedImageFiles.forEach(file => {
                    const li = document.createElement('li');
                    li.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                    ul.appendChild(li);
                });
                fileListDiv.appendChild(ul);
                convertImagesToPdfButton.disabled = false;
            } else {
                fileListDiv.textContent = 'No valid image files (JPG, PNG) selected.';
                convertImagesToPdfButton.disabled = true;
                showStatus('Please select JPG or PNG images.', 'error');
            }
        }

        imageUpload.addEventListener('change', (event) => handleImageFiles(event.target.files));
        dropArea.addEventListener('dragover', (event) => { event.preventDefault(); dropArea.classList.add('drag-over'); });
        dropArea.addEventListener('dragleave', () => dropArea.classList.remove('drag-over'));
        dropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dropArea.classList.remove('drag-over');
            handleImageFiles(event.dataTransfer.files);
        });

        convertImagesToPdfButton.addEventListener('click', async () => {
            if (selectedImageFiles.length === 0) {
                showStatus('Please select some images first.', 'error');
                return;
            }
            // Button loading state
            convertImagesToPdfButton.disabled = true;
            imageButtonText.textContent = 'Processing...';
            imageLoader.classList.remove('hidden');
            showStatus('Starting image to PDF generation...', 'info');
            downloadArea.innerHTML = '';

            try {
                const pdfDoc = await PDFDocument.create();
                const selectedPageSizeOption = imagePageSizeSelect.value;

                for (let i = 0; i < selectedImageFiles.length; i++) {
                    const file = selectedImageFiles[i];
                    showStatus(`Processing image ${i + 1} of ${selectedImageFiles.length}: ${file.name}`, 'info');
                    const imageBytes = await file.arrayBuffer();
                    const embeddedImage = file.type === 'image/jpeg' ? await pdfDoc.embedJpg(imageBytes) : await pdfDoc.embedPng(imageBytes);
                    
                    const { width: imgWidth, height: imgHeight } = embeddedImage.scale(1);
                    let pageWidth, pageHeight;

                    if (selectedPageSizeOption === 'FitImage') {
                        if (i === 0) {
                            pageWidth = imgWidth;
                            pageHeight = imgHeight;
                        } else {
                             const firstPage = pdfDoc.getPage(0);
                             pageWidth = firstPage.getWidth();
                             pageHeight = firstPage.getHeight();
                        }
                    } else {
                        const standardPageSize = PageSizes[selectedPageSizeOption];
                        pageWidth = standardPageSize[0];
                        pageHeight = standardPageSize[1];
                    }
                    
                    const page = pdfDoc.addPage([pageWidth, pageHeight]);
                    const scale = Math.min(page.getWidth() / imgWidth, page.getHeight() / imgHeight);
                    const scaledWidth = imgWidth * scale;
                    const scaledHeight = imgHeight * scale;
                    const xPos = (page.getWidth() - scaledWidth) / 2;
                    const yPos = (page.getHeight() - scaledHeight) / 2;

                    page.drawImage(embeddedImage, { x: xPos, y: yPos, width: scaledWidth, height: scaledHeight });
                }

                if (pdfDoc.getPageCount() === 0) {
                    throw new Error('No valid images were processed.');
                }

                const pdfBytes = await pdfDoc.save();
                offerPdfDownload(pdfBytes, 'images_converted');
                showStatus('Images PDF created successfully!', 'success');

            } catch (error) {
                console.error('Error creating image PDF:', error);
                showStatus(`Error creating image PDF: ${error.message}`, 'error');
            } finally {
                convertImagesToPdfButton.disabled = false;
                imageButtonText.textContent = 'Convert Images to PDF';
                imageLoader.classList.add('hidden');
            }
        });

        // --- Text to PDF Logic ---
        
        convertTextToPdfButton.addEventListener('click', async () => {
            const text = textInput.value.trim();
            if (!text) {
                showStatus('Please enter some text first.', 'error');
                return;
            }
            // Button loading state
            convertTextToPdfButton.disabled = true;
            textButtonText.textContent = 'Processing...';
            textLoader.classList.remove('hidden');
            showStatus('Starting text to PDF generation...', 'info');
            downloadArea.innerHTML = '';

            try {
                const pdfDoc = await PDFDocument.create();
                const standardPageSize = PageSizes[textPageSizeSelect.value];
                const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
                const FONT_SIZE = parseInt(fontSizeInput.value) || 12;
                const PADDING = 50;

                let currentPage = pdfDoc.addPage(standardPageSize);
                let { width, height } = currentPage.getSize();
                let y = height - PADDING;

                const textLines = text.split('\n');

                for (const line of textLines) {
                     const { lines: wrappedLines } = layoutMultilineText(line || ' ', {
                        font,
                        fontSize: FONT_SIZE,
                        bounds: { x: PADDING, y, width: width - 2 * PADDING, height: y - PADDING },
                        lineHeight: FONT_SIZE * 1.2,
                    });

                    for (const wrappedLine of wrappedLines) {
                        const textHeight = FONT_SIZE * 1.2;
                        if (y - textHeight < PADDING) {
                            currentPage = pdfDoc.addPage(standardPageSize);
                            y = currentPage.getHeight() - PADDING;
                        }
                        currentPage.drawText(wrappedLine.text, { x: PADDING, y, font, size: FONT_SIZE, color: rgb(0, 0, 0) });
                        y -= textHeight;
                    }
                }

                const pdfBytes = await pdfDoc.save();
                offerPdfDownload(pdfBytes, 'text_converted');
                showStatus('Text PDF created successfully!', 'success');

            } catch (error) {
                console.error('Error creating text PDF:', error);
                showStatus(`Error creating text PDF: ${error.message}`, 'error');
            } finally {
                convertTextToPdfButton.disabled = false;
                textButtonText.textContent = 'Convert Text to PDF';
                textLoader.classList.add('hidden');
            }
        });


        // --- Merge PDF Logic ---
        function updateMergeFileList() {
            mergeFileListDiv.innerHTML = '';
            if (selectedPdfFiles.length === 0) {
                mergeFileListDiv.textContent = 'No PDF files selected.';
                mergePdfsButton.disabled = true;
                return;
            }

            const ul = document.createElement('ul');
            ul.className = 'list-none p-0 m-0';
            selectedPdfFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                li.className = 'p-2 my-1 bg-stone-600 rounded cursor-move';
                li.draggable = true;
                li.dataset.index = index;

                li.addEventListener('dragstart', (e) => {
                    draggedItem = e.target;
                    setTimeout(() => e.target.style.display = 'none', 0);
                });
                li.addEventListener('dragend', (e) => {
                    setTimeout(() => {
                        draggedItem.style.display = 'block';
                        draggedItem = null;
                    }, 0);
                });
                li.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(ul, e.clientY);
                    const draggingIndex = parseInt(draggedItem.dataset.index);
                    if (afterElement == null) {
                        ul.appendChild(draggedItem);
                        selectedPdfFiles.push(selectedPdfFiles.splice(draggingIndex, 1)[0]);
                    } else {
                        ul.insertBefore(draggedItem, afterElement);
                        const newIndex = Array.from(ul.children).indexOf(draggedItem);
                        selectedPdfFiles.splice(newIndex, 0, selectedPdfFiles.splice(draggingIndex, 1)[0]);
                    }
                     // Re-assign indices after reorder
                    Array.from(ul.children).forEach((child, idx) => child.dataset.index = idx);
                });

                ul.appendChild(li);
            });
            mergeFileListDiv.appendChild(ul);
            mergePdfsButton.disabled = false;
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('li:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function handlePdfFiles(files) {
            downloadArea.innerHTML = '';
            statusArea.textContent = '';
            const acceptedFiles = Array.from(files).filter(file => file.type === 'application/pdf');

            if (acceptedFiles.length > 0) {
                selectedPdfFiles.push(...acceptedFiles);
                updateMergeFileList();
            } else {
                showStatus('Please select valid PDF files.', 'error');
            }
        }

        pdfUpload.addEventListener('change', (event) => handlePdfFiles(event.target.files));
        mergeDropArea.addEventListener('dragover', (event) => { event.preventDefault(); mergeDropArea.classList.add('drag-over'); });
        mergeDropArea.addEventListener('dragleave', () => mergeDropArea.classList.remove('drag-over'));
        mergeDropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            mergeDropArea.classList.remove('drag-over');
            handlePdfFiles(event.dataTransfer.files);
        });

        mergePdfsButton.addEventListener('click', async () => {
            if (selectedPdfFiles.length < 2) {
                showStatus('Please select at least two PDFs to merge.', 'error');
                return;
            }
            // Button loading state
            mergePdfsButton.disabled = true;
            mergeButtonText.textContent = 'Merging...';
            mergeLoader.classList.remove('hidden');
            showStatus('Starting PDF merge...', 'info');
            downloadArea.innerHTML = '';

            try {
                const mergedPdf = await PDFDocument.create();
                for (let i = 0; i < selectedPdfFiles.length; i++) {
                    const file = selectedPdfFiles[i];
                    showStatus(`Processing PDF ${i + 1} of ${selectedPdfFiles.length}: ${file.name}`, 'info');
                    const pdfBytes = await file.arrayBuffer();
                    const pdf = await PDFDocument.load(pdfBytes);
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach((page) => mergedPdf.addPage(page));
                }

                const mergedPdfBytes = await mergedPdf.save();
                offerPdfDownload(mergedPdfBytes, 'merged_pdf');
                showStatus('PDFs merged successfully!', 'success');

            } catch (error) {
                console.error('Error merging PDFs:', error);
                showStatus(`Error merging PDFs: ${error.message}`, 'error');
            } finally {
                mergePdfsButton.disabled = false;
                mergeButtonText.textContent = 'Merge PDFs';
                mergeLoader.classList.add('hidden');
            }
        });

        // --- Initial State ---
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        convertImagesToPdfButton.disabled = true;
        mergePdfsButton.disabled = true;

    </script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4514307373624605"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4514307373624605"
     data-ad-slot="5050185077"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

</body>
</html>
